---
phase: 07-project-templates-linking
plan: 04
type: execute
wave: 3
depends_on: ["07-02", "07-03"]
files_modified:
  - tests/infrastructure/tools/project-template-tools.test.ts
  - tests/infrastructure/tools/project-linking-tools.test.ts
  - docs/TOOLS.md
  - STATUS.md
autonomous: true

must_haves:
  truths:
    - "Template tool tests pass for all 4 operations"
    - "Linking tool tests pass for all 6 operations"
    - "Tool count increased from 93 to 103 (10 new tools)"
    - "Documentation covers all 10 new tools with examples"
  artifacts:
    - path: "tests/infrastructure/tools/project-template-tools.test.ts"
      provides: "Tests for template MCP tools"
      min_lines: 150
    - path: "tests/infrastructure/tools/project-linking-tools.test.ts"
      provides: "Tests for linking MCP tools"
      min_lines: 200
    - path: "docs/TOOLS.md"
      provides: "Updated tool documentation with all 103 tools"
      contains: "mark_project_as_template"
  key_links:
    - from: "project-template-tools.test.ts"
      to: "project-template-tools.ts"
      via: "import and test"
      pattern: "import.*project-template-tools"
    - from: "project-linking-tools.test.ts"
      to: "project-linking-tools.ts"
      via: "import and test"
      pattern: "import.*project-linking-tools"
---

<objective>
Add comprehensive tests for Phase 7 tools and update documentation.

Purpose: Ensure all new tools have proper test coverage and are documented.
Output: ~60 new tests across 2 test files, updated TOOLS.md with 10 new tools documented.
</objective>

<execution_context>
@/Users/vivek/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vivek/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-project-templates-linking/07-02-SUMMARY.md
@.planning/phases/07-project-templates-linking/07-03-SUMMARY.md
@tests/infrastructure/tools/sub-issue-tools.test.ts
@docs/TOOLS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create template tool tests</name>
  <files>tests/infrastructure/tools/project-template-tools.test.ts</files>
  <action>
Create tests following sub-issue-tools.test.ts patterns:

**Schema Validation Tests:**
- `MarkProjectAsTemplateInputSchema` rejects missing projectId
- `MarkProjectAsTemplateInputSchema` accepts valid projectId
- `CopyProjectFromTemplateInputSchema` rejects missing required fields
- `CopyProjectFromTemplateInputSchema` accepts all valid fields including optional includeDraftIssues
- `ListOrganizationTemplatesInputSchema` applies default values for first/after
- (Similar for other input schemas)

**Tool Definition Tests:**
- `markProjectAsTemplateTool` has correct name, title, annotations (updateIdempotent)
- `unmarkProjectAsTemplateTool` has correct annotations
- `copyProjectFromTemplateTool` has create annotation
- `listOrganizationTemplatesTool` has readOnly annotation
- All tools have proper outputSchema set

**Executor Tests (mock GraphQL):**
Use jest.mock for GitHubRepositoryFactory to mock graphql calls:

- `executeMarkProjectAsTemplate` calls mutation and returns project with isTemplate=true
- `executeUnmarkProjectAsTemplate` calls mutation and returns project with isTemplate=false
- `executeCopyProjectFromTemplate` resolves org ID and calls copy mutation
- `executeCopyProjectFromTemplate` handles org not found error
- `executeListOrganizationTemplates` filters by isTemplate field
- `executeListOrganizationTemplates` returns empty array when no templates
- `executeListOrganizationTemplates` handles pagination correctly
- Error handling: missing GITHUB_TOKEN returns appropriate error
- Error handling: invalid projectId returns appropriate error

Mock responses with realistic data:
```typescript
const mockProject = {
  projectV2: {
    id: "PVT_kwDOTest123",
    title: "Test Template",
    isTemplate: true,
    url: "https://github.com/orgs/testorg/projects/1"
  }
};
```
  </action>
  <verify>`npm test -- --testPathPattern="project-template-tools"` passes all tests.</verify>
  <done>~25 template tool tests pass covering schemas, definitions, and executors.</done>
</task>

<task type="auto">
  <name>Task 2: Create linking tool tests</name>
  <files>tests/infrastructure/tools/project-linking-tools.test.ts</files>
  <action>
Create tests following sub-issue-tools.test.ts patterns:

**Schema Validation Tests:**
- `LinkProjectToRepositoryInputSchema` rejects missing required fields
- `LinkProjectToRepositoryInputSchema` accepts valid input
- `LinkProjectToTeamInputSchema` validates teamSlug format
- `ListLinkedRepositoriesInputSchema` applies default first=20
- (Similar for all 6 input schemas)

**Tool Definition Tests:**
- `linkProjectToRepositoryTool` has updateIdempotent annotation
- `unlinkProjectFromRepositoryTool` has delete annotation with destructiveHint
- `linkProjectToTeamTool` has updateIdempotent annotation
- `unlinkProjectFromTeamTool` has delete annotation
- `listLinkedRepositoriesTool` has readOnly annotation
- `listLinkedTeamsTool` has readOnly annotation
- All tools have proper outputSchema set

**Executor Tests (mock GraphQL):**

- `executeLinkProjectToRepository` resolves repo ID and links
- `executeLinkProjectToRepository` handles repo not found error
- `executeUnlinkProjectFromRepository` unlinks and returns success
- `executeLinkProjectToTeam` resolves team ID and links
- `executeLinkProjectToTeam` handles team not found error
- `executeUnlinkProjectFromTeam` unlinks and returns success
- `executeListLinkedRepositories` returns paginated list
- `executeListLinkedRepositories` handles empty list
- `executeListLinkedRepositories` handles pagination cursor
- `executeListLinkedTeams` returns paginated list
- `executeListLinkedTeams` handles empty list
- Error handling for all executors

Mock responses:
```typescript
const mockLinkedRepo = {
  repository: {
    id: "R_kgTest123",
    name: "test-repo",
    nameWithOwner: "testorg/test-repo",
    url: "https://github.com/testorg/test-repo",
    description: "Test repository"
  }
};

const mockLinkedTeam = {
  team: {
    id: "T_kwTest123",
    name: "Test Team",
    slug: "test-team",
    description: "Test team"
  }
};
```
  </action>
  <verify>`npm test -- --testPathPattern="project-linking-tools"` passes all tests.</verify>
  <done>~35 linking tool tests pass covering schemas, definitions, and executors.</done>
</task>

<task type="auto">
  <name>Task 3: Update documentation and verify phase</name>
  <files>docs/TOOLS.md, STATUS.md</files>
  <action>
**Update docs/TOOLS.md:**

Add new section "## Project Template Tools" after Project Tools section:

```markdown
## Project Template Tools

### mark_project_as_template

Marks an organization project as a template.

**Parameters:**
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| projectId | string | Yes | Project node ID (PVT_...) |

**Example:**
\`\`\`json
{
  "projectId": "PVT_kwDOABC123"
}
\`\`\`

### unmark_project_as_template

Removes template status from a project.

### copy_project_from_template

Creates a new project by copying from a template.

**Parameters:**
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| projectId | string | Yes | Source template project ID |
| targetOwner | string | Yes | Organization login |
| title | string | Yes | New project title |
| includeDraftIssues | boolean | No | Include draft issues (default: false) |

### list_organization_templates

Lists all project templates in an organization.
```

Add new section "## Project Linking Tools":

```markdown
## Project Linking Tools

### link_project_to_repository

Links a project to a repository.

**Parameters:**
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| projectId | string | Yes | Project node ID |
| owner | string | Yes | Repository owner |
| repo | string | Yes | Repository name |

### unlink_project_from_repository

Removes a repository linkage from a project.

### link_project_to_team

Links a project to a team.

**Parameters:**
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| projectId | string | Yes | Project node ID |
| org | string | Yes | Organization login |
| teamSlug | string | Yes | Team slug |

### unlink_project_from_team

Removes a team linkage from a project.

### list_linked_repositories

Lists all repositories linked to a project.

### list_linked_teams

Lists all teams linked to a project.
```

**Update STATUS.md:**
- Update tool count from 93 to 103
- Add Phase 7 completion entry
- Update categories to include Template (4) and Linking (6)

**Run full verification:**
1. `npm run build` - TypeScript compiles
2. `npm test` - All tests pass (677 + ~60 new = ~737)
3. Count tools in ToolRegistry to verify 103 total
  </action>
  <verify>`npm test` passes all tests. Tool count is 103. TOOLS.md documents all 10 new tools.</verify>
  <done>TOOLS.md documents all 10 new tools. STATUS.md updated. All tests pass.</done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds with no TypeScript errors
2. `npm test` passes all tests (previous 677 + ~60 new)
3. `grep -c "template\|linking" docs/TOOLS.md` shows documentation
4. Tool count in ToolRegistry is 103 (93 + 10 new)
5. All Phase 7 requirements (GHAPI-09 to GHAPI-18) are implemented
</verification>

<success_criteria>
- Template tools have 25+ tests covering schemas, definitions, executors
- Linking tools have 35+ tests covering schemas, definitions, executors
- TOOLS.md documents all 10 new tools with parameters and examples
- STATUS.md reflects 103 total tools
- Tool categories updated to include Template and Linking
- `npm test` reports 0 failures
</success_criteria>

<output>
After completion, create `.planning/phases/07-project-templates-linking/07-04-SUMMARY.md`
</output>
