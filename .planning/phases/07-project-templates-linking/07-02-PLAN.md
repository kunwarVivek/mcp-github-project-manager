---
phase: 07-project-templates-linking
plan: 02
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - src/infrastructure/tools/project-template-tools.ts
  - src/infrastructure/tools/ToolSchemas.ts
  - src/infrastructure/tools/ToolRegistry.ts
autonomous: true

must_haves:
  truths:
    - "mark_project_as_template marks org projects as templates"
    - "unmark_project_as_template removes template status"
    - "copy_project_from_template creates new project with copied structure"
    - "list_organization_templates returns filtered template list"
  artifacts:
    - path: "src/infrastructure/tools/project-template-tools.ts"
      provides: "4 MCP tool definitions and executors for template operations"
      exports: ["markProjectAsTemplateTool", "copyProjectFromTemplateTool", "executeMarkProjectAsTemplate"]
    - path: "src/infrastructure/tools/ToolRegistry.ts"
      provides: "Tool registration for template tools"
      contains: "mark_project_as_template"
  key_links:
    - from: "project-template-tools.ts"
      to: "project-template-linking-schemas.ts"
      via: "import schemas"
      pattern: "import.*project-template-linking-schemas"
    - from: "ToolRegistry.ts"
      to: "project-template-tools.ts"
      via: "import and registration"
      pattern: "import.*project-template-tools"
---

<objective>
Create 4 MCP tools for project template operations (GHAPI-09 to GHAPI-12).

Purpose: Enable MCP clients to manage GitHub project templates.
Output: 4 fully-annotated MCP tools with schemas, executors, and proper registration.
</objective>

<execution_context>
@/Users/vivek/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vivek/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-project-templates-linking/07-RESEARCH.md
@.planning/phases/07-project-templates-linking/07-01-SUMMARY.md
@src/infrastructure/tools/sub-issue-tools.ts
@src/infrastructure/tools/annotations/tool-annotations.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create template tool definitions</name>
  <files>src/infrastructure/tools/project-template-tools.ts</files>
  <action>
Create project-template-tools.ts following the sub-issue-tools.ts pattern:

**Helper Functions:**

1. `createFactory(owner, repo)` - Creates GitHubRepositoryFactory (use placeholder owner/repo since templates use projectId)
2. `resolveOrganizationId(factory, orgLogin)` - Resolves org login to node ID
   ```typescript
   const RESOLVE_ORG_ID_QUERY = `
     query ResolveOrganizationId($login: String!) {
       organization(login: $login) {
         id
       }
     }
   `;
   ```

**Tool 1: mark_project_as_template (GHAPI-09)**
- name: "mark_project_as_template"
- title: "Mark Project as Template"
- description: "Marks an organization project as a template. Only organization-owned projects can be templates."
- annotations: ANNOTATION_PATTERNS.updateIdempotent
- schema: MarkProjectAsTemplateInputSchema
- outputSchema: TemplateProjectOutputSchema

Executor `executeMarkProjectAsTemplate`:
1. Create factory with placeholder owner/repo (project operations use node ID directly)
2. Execute markProjectV2AsTemplate mutation:
   ```graphql
   mutation MarkProjectV2AsTemplate($input: MarkProjectV2AsTemplateInput!) {
     markProjectV2AsTemplate(input: $input) {
       projectV2 { id title isTemplate url }
     }
   }
   ```
3. Return structured result matching output schema

**Tool 2: unmark_project_as_template (GHAPI-10)**
- name: "unmark_project_as_template"
- title: "Unmark Project as Template"
- description: "Removes template status from a project."
- annotations: ANNOTATION_PATTERNS.updateIdempotent
- schema: UnmarkProjectAsTemplateInputSchema
- outputSchema: TemplateProjectOutputSchema

Executor `executeUnmarkProjectAsTemplate`:
1. Execute unmarkProjectV2AsTemplate mutation
2. Return structured result

**Tool 3: copy_project_from_template (GHAPI-11)**
- name: "copy_project_from_template"
- title: "Copy Project from Template"
- description: "Creates a new project by copying from a template. Copies views, custom fields, draft issues (optional), workflows, and insights."
- annotations: ANNOTATION_PATTERNS.create
- schema: CopyProjectFromTemplateInputSchema
- outputSchema: CopiedProjectOutputSchema

Executor `executeCopyProjectFromTemplate`:
1. Resolve targetOwner (org login) to node ID using resolveOrganizationId helper
2. Execute copyProjectV2 mutation:
   ```graphql
   mutation CopyProjectV2($input: CopyProjectV2Input!) {
     copyProjectV2(input: $input) {
       projectV2 { id title number url createdAt shortDescription }
     }
   }
   ```
3. Return structured result

**Tool 4: list_organization_templates (GHAPI-12)**
- name: "list_organization_templates"
- title: "List Organization Templates"
- description: "Lists all project templates in an organization."
- annotations: ANNOTATION_PATTERNS.readOnly
- schema: ListOrganizationTemplatesInputSchema
- outputSchema: TemplateListOutputSchema

Executor `executeListOrganizationTemplates`:
1. Query organization's projectsV2:
   ```graphql
   query ListOrganizationTemplates($orgLogin: String!, $first: Int!, $after: String) {
     organization(login: $orgLogin) {
       projectsV2(first: $first, after: $after) {
         nodes { id title number shortDescription url isTemplate createdAt updatedAt }
         pageInfo { hasNextPage endCursor }
         totalCount
       }
     }
   }
   ```
2. Filter nodes where isTemplate === true (client-side)
3. Return filtered templates with pagination info

Export all 4 tool definitions and 4 executor functions.
  </action>
  <verify>TypeScript compiles. `grep -c "ToolDefinition" src/infrastructure/tools/project-template-tools.ts` shows 4 tool definitions.</verify>
  <done>project-template-tools.ts exports 4 template tool definitions with executors.</done>
</task>

<task type="auto">
  <name>Task 2: Register template tools</name>
  <files>src/infrastructure/tools/ToolSchemas.ts, src/infrastructure/tools/ToolRegistry.ts</files>
  <action>
**In ToolSchemas.ts:**
1. Import template tools from project-template-tools.ts:
   ```typescript
   export {
     markProjectAsTemplateTool,
     unmarkProjectAsTemplateTool,
     copyProjectFromTemplateTool,
     listOrganizationTemplatesTool,
   } from "./project-template-tools.js";
   ```

**In ToolRegistry.ts:**
1. Import template tools and executors:
   ```typescript
   import {
     markProjectAsTemplateTool,
     unmarkProjectAsTemplateTool,
     copyProjectFromTemplateTool,
     listOrganizationTemplatesTool,
     executeMarkProjectAsTemplate,
     executeUnmarkProjectAsTemplate,
     executeCopyProjectFromTemplate,
     executeListOrganizationTemplates,
   } from "./project-template-tools.js";
   ```

2. Add to tools array in registerTools():
   ```typescript
   markProjectAsTemplateTool,
   unmarkProjectAsTemplateTool,
   copyProjectFromTemplateTool,
   listOrganizationTemplatesTool,
   ```

3. Add executor mappings in executeTool switch:
   ```typescript
   case "mark_project_as_template":
     return executeMarkProjectAsTemplate(args);
   case "unmark_project_as_template":
     return executeUnmarkProjectAsTemplate(args);
   case "copy_project_from_template":
     return executeCopyProjectFromTemplate(args);
   case "list_organization_templates":
     return executeListOrganizationTemplates(args);
   ```
  </action>
  <verify>TypeScript compiles. `npm run build` succeeds. `grep -c "template" src/infrastructure/tools/ToolRegistry.ts` shows all tools registered.</verify>
  <done>All 4 template tools registered in ToolRegistry with executors wired.</done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds with no TypeScript errors
2. All 4 tools have proper annotations matching research matrix
3. All tools have output schemas matching Zod schemas
4. ToolRegistry registers all 4 template tools
5. `grep -r "ANNOTATION_PATTERNS" src/infrastructure/tools/project-template-tools.ts` confirms annotation usage
</verification>

<success_criteria>
- 4 tool definitions with annotations, schemas, and outputSchemas
- 4 executor functions that call GraphQL directly via factory
- resolveOrganizationId helper for copy operation
- All tools registered in ToolRegistry
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/07-project-templates-linking/07-02-SUMMARY.md`
</output>
