---
phase: 06-sub-issues-status-updates
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - src/infrastructure/tools/schemas/sub-issue-schemas.ts
  - src/infrastructure/tools/sub-issue-tools.ts
  - src/infrastructure/tools/ToolSchemas.ts
  - src/infrastructure/tools/ToolRegistry.ts
autonomous: true

must_haves:
  truths:
    - "add_sub_issue tool creates parent-child relationship"
    - "list_sub_issues tool returns flat list with pagination"
    - "get_parent_issue tool returns parent or null"
    - "reprioritize_sub_issue tool changes sub-issue order"
    - "remove_sub_issue tool breaks parent-child relationship"
  artifacts:
    - path: "src/infrastructure/tools/schemas/sub-issue-schemas.ts"
      provides: "Zod schemas for sub-issue tool inputs and outputs"
      exports: ["AddSubIssueSchema", "SubIssueOutputSchema", "SubIssueListOutputSchema"]
    - path: "src/infrastructure/tools/sub-issue-tools.ts"
      provides: "5 MCP tool definitions and executors"
      exports: ["addSubIssueTool", "listSubIssuesTool", "getParentIssueTool", "reprioritizeSubIssueTool", "removeSubIssueTool"]
    - path: "src/infrastructure/tools/ToolRegistry.ts"
      provides: "Tool registration for all sub-issue tools"
      contains: "addSubIssueTool"
  key_links:
    - from: "sub-issue-tools.ts"
      to: "GitHubSubIssueRepository"
      via: "executor functions"
      pattern: "createSubIssueRepository"
    - from: "ToolRegistry.ts"
      to: "sub-issue-tools.ts"
      via: "import and registration"
      pattern: "import.*sub-issue-tools"
---

<objective>
Create 5 MCP tools for sub-issue management (GHAPI-01 to GHAPI-05).

Purpose: Enable MCP clients to manage GitHub sub-issue hierarchies.
Output: 5 fully-annotated MCP tools with schemas, executors, and proper registration.
</objective>

<execution_context>
@/Users/vivek/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vivek/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-sub-issues-status-updates/06-RESEARCH.md
@.planning/phases/06-sub-issues-status-updates/06-01-SUMMARY.md
@src/infrastructure/tools/health-tools.ts
@src/infrastructure/tools/ToolSchemas.ts
@src/infrastructure/tools/annotations/tool-annotations.ts
@src/infrastructure/tools/schemas/project-schemas.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create sub-issue Zod schemas</name>
  <files>src/infrastructure/tools/schemas/sub-issue-schemas.ts</files>
  <action>
Create Zod schemas for sub-issue tools in a new file:

**Input Schemas:**

1. `AddSubIssueInputSchema`:
   - owner: z.string() - Repository owner
   - repo: z.string() - Repository name
   - parentIssueNumber: z.number() - Parent issue number (not node ID)
   - subIssueNumber: z.number() - Child issue number
   - replaceParent: z.boolean().optional().default(false)

2. `ListSubIssuesInputSchema`:
   - owner: z.string()
   - repo: z.string()
   - issueNumber: z.number() - Parent issue number
   - first: z.number().optional().default(20)
   - after: z.string().optional() - Cursor for pagination

3. `GetParentIssueInputSchema`:
   - owner: z.string()
   - repo: z.string()
   - issueNumber: z.number() - The issue to find parent for

4. `ReprioritizeSubIssueInputSchema`:
   - owner: z.string()
   - repo: z.string()
   - parentIssueNumber: z.number()
   - subIssueNumber: z.number() - The sub-issue to move
   - afterIssueNumber: z.number().optional() - Move after this issue (null = beginning)

5. `RemoveSubIssueInputSchema`:
   - owner: z.string()
   - repo: z.string()
   - parentIssueNumber: z.number()
   - subIssueNumber: z.number()

**Output Schemas:**

1. `SubIssueOutputSchema`:
   - id: z.string()
   - number: z.number()
   - title: z.string()
   - state: z.enum(['open', 'closed'])
   - url: z.string()

2. `SubIssueListOutputSchema`:
   - subIssues: z.array(SubIssueOutputSchema.extend({ position: z.number() }))
   - summary: z.object({ total, completed, percentCompleted })
   - pageInfo: z.object({ hasNextPage, endCursor })
   - totalCount: z.number()

3. `ParentIssueOutputSchema`:
   - parent: SubIssueOutputSchema.nullable()

4. `RemoveSubIssueOutputSchema`:
   - success: z.boolean()
   - message: z.string()

Export all schemas and inferred types.
  </action>
  <verify>TypeScript compiles. `grep -c "z.object" src/infrastructure/tools/schemas/sub-issue-schemas.ts` shows multiple schemas defined.</verify>
  <done>sub-issue-schemas.ts exists with all input and output Zod schemas.</done>
</task>

<task type="auto">
  <name>Task 2: Create sub-issue tool definitions and executors</name>
  <files>src/infrastructure/tools/sub-issue-tools.ts</files>
  <action>
Create 5 MCP tool definitions following health-tools.ts pattern:

**1. add_sub_issue (GHAPI-01)**
- name: "add_sub_issue"
- title: "Add Sub-Issue"
- description: "Adds an existing issue as a sub-issue of a parent issue"
- annotations: ANNOTATION_PATTERNS.updateIdempotent
- schema: AddSubIssueInputSchema
- outputSchema: SubIssueOutputSchema

Executor `executeAddSubIssue`:
1. Create GitHubRepositoryFactory with args (owner, repo, token from env)
2. Create GitHubSubIssueRepository
3. Resolve issue numbers to node IDs
4. Call addSubIssue
5. Return structured result

**2. list_sub_issues (GHAPI-02)**
- name: "list_sub_issues"
- title: "List Sub-Issues"
- description: "Lists all sub-issues for a parent issue"
- annotations: ANNOTATION_PATTERNS.readOnly
- schema: ListSubIssuesInputSchema
- outputSchema: SubIssueListOutputSchema

**3. get_parent_issue (GHAPI-03)**
- name: "get_parent_issue"
- title: "Get Parent Issue"
- description: "Gets the parent issue for a sub-issue, if any"
- annotations: ANNOTATION_PATTERNS.readOnly
- schema: GetParentIssueInputSchema
- outputSchema: ParentIssueOutputSchema

**4. reprioritize_sub_issue (GHAPI-04)**
- name: "reprioritize_sub_issue"
- title: "Reprioritize Sub-Issue"
- description: "Changes the position of a sub-issue within its parent"
- annotations: ANNOTATION_PATTERNS.updateIdempotent
- schema: ReprioritizeSubIssueInputSchema
- outputSchema: SubIssueOutputSchema

**5. remove_sub_issue (GHAPI-05)**
- name: "remove_sub_issue"
- title: "Remove Sub-Issue"
- description: "Removes a sub-issue relationship (issue remains, just unlinked)"
- annotations: ANNOTATION_PATTERNS.delete
- schema: RemoveSubIssueInputSchema
- outputSchema: RemoveSubIssueOutputSchema

Each executor must:
1. Get token from process.env.GITHUB_TOKEN
2. Create factory with owner/repo/token
3. Resolve issue numbers to node IDs before calling repository
4. Handle errors with appropriate MCP error codes
5. Return structuredContent for object results

Export all tool definitions and executor functions.
  </action>
  <verify>TypeScript compiles. `grep -c "ToolDefinition" src/infrastructure/tools/sub-issue-tools.ts` shows 5 tool definitions.</verify>
  <done>sub-issue-tools.ts exports 5 tool definitions with executors.</done>
</task>

<task type="auto">
  <name>Task 3: Register sub-issue tools in ToolRegistry</name>
  <files>src/infrastructure/tools/ToolSchemas.ts, src/infrastructure/tools/ToolRegistry.ts</files>
  <action>
**In ToolSchemas.ts:**
1. Import all sub-issue tools from sub-issue-tools.ts
2. Re-export them (following existing pattern for AI tools)

**In ToolRegistry.ts:**
1. Import sub-issue tools:
   ```typescript
   import {
     addSubIssueTool,
     listSubIssuesTool,
     getParentIssueTool,
     reprioritizeSubIssueTool,
     removeSubIssueTool,
     executeAddSubIssue,
     executeListSubIssues,
     executeGetParentIssue,
     executeReprioritizeSubIssue,
     executeRemoveSubIssue,
   } from "./sub-issue-tools.js";
   ```

2. Add to tools array in registerTools():
   ```typescript
   addSubIssueTool,
   listSubIssuesTool,
   getParentIssueTool,
   reprioritizeSubIssueTool,
   removeSubIssueTool,
   ```

3. Add executor mappings in executeTool switch:
   ```typescript
   case "add_sub_issue":
     return executeAddSubIssue(args);
   case "list_sub_issues":
     return executeListSubIssues(args);
   case "get_parent_issue":
     return executeGetParentIssue(args);
   case "reprioritize_sub_issue":
     return executeReprioritizeSubIssue(args);
   case "remove_sub_issue":
     return executeRemoveSubIssue(args);
   ```

Follow the exact patterns used for health_check tool and AI tools.
  </action>
  <verify>TypeScript compiles. `npm run build` succeeds. `grep -c "sub_issue" src/infrastructure/tools/ToolRegistry.ts` shows all tools registered.</verify>
  <done>All 5 sub-issue tools registered in ToolRegistry with executors wired.</done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds with no TypeScript errors
2. All 5 tools have proper annotations matching research matrix
3. All tools have output schemas matching Zod schemas
4. ToolRegistry registers all 5 sub-issue tools
5. `grep -r "ANNOTATION_PATTERNS" src/infrastructure/tools/sub-issue-tools.ts` confirms annotation usage
</verification>

<success_criteria>
- 5 Zod input schemas and 4 output schemas defined
- 5 tool definitions with annotations, schemas, and outputSchemas
- 5 executor functions that call GitHubSubIssueRepository
- All tools registered in ToolRegistry
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/06-sub-issues-status-updates/06-02-SUMMARY.md`
</output>
