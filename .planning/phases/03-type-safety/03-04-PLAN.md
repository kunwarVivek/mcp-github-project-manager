---
phase: 03-type-safety
plan: 04
type: execute
wave: 2
depends_on: ["03-02"]
files_modified:
  - src/domain/ai-types.ts
  - src/services/TaskContextGenerationService.ts
  - src/services/TaskGenerationService.ts
  - src/services/FeatureManagementService.ts
  - src/infrastructure/tools/ai-tasks/ParsePRDTool.ts
  - src/infrastructure/tools/ai-tasks/CreateTraceabilityMatrixTool.ts
autonomous: true

must_haves:
  truths:
    - "AI service functions accept base types and handle enhanced types internally"
    - "Mock PRD objects have proper interface definitions"
    - "Status enum values are used instead of string assertions"
    - "TypeScript strict mode produces no errors"
  artifacts:
    - path: "src/domain/ai-types.ts"
      provides: "MockPRD interface for tool testing"
      exports: ["MockPRD"]
    - path: "src/services/TaskContextGenerationService.ts"
      provides: "Dependency context generation with proper typing"
      pattern: "TaskDependency\\[\\]"
    - path: "src/services/FeatureManagementService.ts"
      provides: "Feature management with enum status"
      pattern: "ProjectItemStatus\\."
  key_links:
    - from: "TaskContextGenerationService.ts"
      to: "ai-types.ts"
      via: "TaskDependency import"
      pattern: "import.*TaskDependency"
    - from: "ParsePRDTool.ts"
      to: "ai-types.ts"
      via: "MockPRD import"
      pattern: "import.*MockPRD"
---

<objective>
Fix type compatibility issues in AI services and tool mock types.

Purpose: Address the remaining `as any` assertions in AI-related services by defining proper interfaces, fixing function signatures, and using enum values correctly.
Output: 6 files updated with proper typing for AI response handling, mock objects, and enum usage.
</objective>

<execution_context>
@/Users/vivek/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vivek/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-type-safety/03-RESEARCH.md

@src/domain/ai-types.ts
@src/services/TaskContextGenerationService.ts
@src/services/TaskGenerationService.ts
@src/services/FeatureManagementService.ts
@src/infrastructure/tools/ai-tasks/ParsePRDTool.ts
@src/infrastructure/tools/ai-tasks/CreateTraceabilityMatrixTool.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Define MockPRD interface and fix tool mock types</name>
  <files>
src/domain/ai-types.ts
src/infrastructure/tools/ai-tasks/ParsePRDTool.ts
src/infrastructure/tools/ai-tasks/CreateTraceabilityMatrixTool.ts
  </files>
  <action>
**Step 1: Add MockPRD interface to ai-types.ts**

Add a minimal interface for mock PRD objects used in tools:
```typescript
/**
 * Minimal PRD structure for mock/test purposes.
 * Used when generating sample outputs before actual PRD parsing.
 */
export interface MockPRD {
  title: string;
  description?: string;
  features?: string[];
  // Add other fields as needed based on actual usage
}
```

Examine ParsePRDTool.ts line 110 and CreateTraceabilityMatrixTool.ts lines 85-86 to determine what properties the mock PRD needs.

**Step 2: Update ParsePRDTool.ts (line 110)**
- Import MockPRD from domain/ai-types
- Replace `mockPRD as any` with properly typed mockPRD
- Ensure mockPRD object matches MockPRD interface

**Step 3: Update CreateTraceabilityMatrixTool.ts (lines 85-86)**
- Import MockPRD from domain/ai-types
- Replace `mockPRD as any` and `args.features as any` with proper types
- Define the expected feature type if different from string[]
  </action>
  <verify>
```bash
# Verify MockPRD interface exists
grep -n "interface MockPRD" src/domain/ai-types.ts

# Verify no as any for mockPRD
echo "=== ParsePRDTool mockPRD as any ==="
grep -n "mockPRD as any" src/infrastructure/tools/ai-tasks/ParsePRDTool.ts && echo "FAIL" || echo "PASS"

echo "=== CreateTraceabilityMatrixTool as any ==="
grep -n "as any" src/infrastructure/tools/ai-tasks/CreateTraceabilityMatrixTool.ts && echo "FAIL" || echo "PASS"
```
  </verify>
  <done>MockPRD interface defined, tool files use typed mock objects</done>
</task>

<task type="auto">
  <name>Task 2: Fix AI service function signatures</name>
  <files>
src/services/TaskContextGenerationService.ts
src/services/TaskGenerationService.ts
  </files>
  <action>
**TaskContextGenerationService.ts (line 252):**
The issue is passing `TaskDependency[]` where `EnhancedTaskDependency[]` is expected.

Option A: Change function signature to accept base type
```typescript
// Change parameter type to accept TaskDependency[]
async generateDependencyContext(
  task: AITask,
  allTasks: AITask[],
  dependencies?: TaskDependency[] // Accept base type
): Promise<DependencyContext | null>
```

Option B: Add type guard and convert internally
```typescript
// Keep EnhancedTaskDependency[] but convert at call site
const enhancedDeps = task.dependencies?.map(d => ({
  ...d,
  // Add default values for enhanced fields
  description: '',
  status: 'pending'
})) as EnhancedTaskDependency[];
```

Choose the option that best fits the codebase pattern. Option A is cleaner if enhanced fields aren't used.

**TaskGenerationService.ts (line 114):**
- Use the MockPRD interface defined in Task 1
- Replace `mockPRD as any` with properly typed mockPRD
  </action>
  <verify>
```bash
echo "=== TaskContextGenerationService as any ==="
grep -n "as any" src/services/TaskContextGenerationService.ts && echo "FAIL" || echo "PASS"

echo "=== TaskGenerationService as any ==="
grep -n "as any" src/services/TaskGenerationService.ts && echo "FAIL" || echo "PASS"
```
  </verify>
  <done>AI service functions have proper type signatures without as any casts</done>
</task>

<task type="auto">
  <name>Task 3: Fix FeatureManagementService enum usage</name>
  <files>src/services/FeatureManagementService.ts</files>
  <action>
**FeatureManagementService.ts (line 377):**
The issue is using a status string instead of proper enum value.

Find the correct enum for project item status. It should be in the domain types or GitHub types:
- Look for `ProjectItemStatus` or similar enum
- If it doesn't exist, define it based on GitHub's valid status values

Replace:
```typescript
status: params.updateData.status as any,
```

With:
```typescript
status: params.updateData.status as ProjectItemStatus, // If status is already validated
// OR
status: validateProjectItemStatus(params.updateData.status), // If validation needed
```

If the status comes from user input and needs validation:
```typescript
// Add type guard
function isValidProjectItemStatus(status: string): status is ProjectItemStatus {
  return Object.values(ProjectItemStatus).includes(status as ProjectItemStatus);
}

// Use at call site
if (!isValidProjectItemStatus(params.updateData.status)) {
  throw new Error(`Invalid status: ${params.updateData.status}`);
}
status: params.updateData.status,
```
  </action>
  <verify>
```bash
echo "=== FeatureManagementService as any ==="
grep -n "as any" src/services/FeatureManagementService.ts && echo "FAIL" || echo "PASS"

# Verify status is properly typed
grep -n "status:" src/services/FeatureManagementService.ts | grep -v "as any"
```
  </verify>
  <done>FeatureManagementService uses proper status enum values</done>
</task>

</tasks>

<verification>
```bash
cd /Users/vivek/jet/mcp-github-project-manager

# Count as any in AI service files
echo "=== AI services as any remaining ==="
for f in src/services/TaskContextGenerationService.ts src/services/TaskGenerationService.ts src/services/FeatureManagementService.ts; do
  echo "$f: $(grep -c 'as any' $f 2>/dev/null || echo 0)"
done

echo "=== AI tools as any remaining ==="
for f in src/infrastructure/tools/ai-tasks/ParsePRDTool.ts src/infrastructure/tools/ai-tasks/CreateTraceabilityMatrixTool.ts; do
  echo "$f: $(grep -c 'as any' $f 2>/dev/null || echo 0)"
done

# TypeScript compilation
npx tsc --noEmit && echo "TypeScript: PASS" || echo "TypeScript: FAIL"

# Tests pass
npm test 2>&1 | grep -E "(passed|failed|Tests:)"
```
</verification>

<success_criteria>
1. MockPRD interface exists in ai-types.ts
2. Zero `as any` in TaskContextGenerationService.ts
3. Zero `as any` in TaskGenerationService.ts
4. Zero `as any` in FeatureManagementService.ts
5. Zero `as any` in ParsePRDTool.ts
6. Zero `as any` in CreateTraceabilityMatrixTool.ts
7. TypeScript compiles without errors
8. All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/03-type-safety/03-04-SUMMARY.md`
</output>
