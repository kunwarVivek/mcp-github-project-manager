---
phase: 03-type-safety
plan: 05
type: execute
wave: 3
depends_on: ["03-01", "03-02", "03-03", "03-04"]
files_modified:
  - src/index.ts
autonomous: true

must_haves:
  truths:
    - "MCP SDK workaround is documented with clear explanation"
    - "Zero as any in production code except documented SDK exception"
    - "grep confirms as any count matches expected (1 documented exception)"
  artifacts:
    - path: "src/index.ts"
      provides: "MCP server with documented SDK type workaround"
      contains: "// SDK LIMITATION: MCP SDK 1.25+"
  key_links:
    - from: "ROADMAP.md Phase 3"
      to: "grep verification"
      via: "success criteria verification"
      pattern: "Zero.*as any"
---

<objective>
Document the MCP SDK workaround and verify phase completion with final `as any` audit.

Purpose: Ensure the one remaining `as any` (MCP SDK type depth limitation) is properly documented, and verify all other `as any` assertions have been eliminated from production code.
Output: Documented SDK workaround in index.ts, verification report confirming phase success criteria.
</objective>

<execution_context>
@/Users/vivek/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vivek/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-type-safety/03-RESEARCH.md

@src/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Document MCP SDK type workaround</name>
  <files>src/index.ts</files>
  <action>
Add comprehensive documentation for the SDK workaround at line 237.

Current code:
```typescript
(this.server.setRequestHandler as any)(
```

Add documentation above it:
```typescript
/**
 * SDK LIMITATION: MCP SDK 1.25+ Type Instantiation Depth Error
 *
 * The MCP SDK's generic types cause TypeScript error TS2589:
 * "Type instantiation is excessively deep and possibly infinite"
 *
 * This occurs because:
 * 1. CallToolRequestSchema has deeply nested ZodObject types
 * 2. Combined with our complex inputSchema definitions
 * 3. TypeScript's type instantiation limit is exceeded
 *
 * Workaround: Use type assertion with explicit request/result types.
 * The handler still receives properly typed CallToolRequest and
 * returns properly typed CallToolResult.
 *
 * Tracked: This is a known SDK issue, not a codebase type safety gap.
 * Review: Check if future SDK versions (>1.25.3) resolve this.
 *
 * @see https://github.com/modelcontextprotocol/typescript-sdk/issues/XXX (if exists)
 */
(this.server.setRequestHandler as any)(
  CallToolRequestSchema,
  async (request: CallToolRequest): Promise<CallToolResult> => {
    // Handler implementation...
  }
);
```

Ensure the comment block is clear and explains:
1. What the error is
2. Why it happens
3. Why this is an SDK limitation, not a codebase issue
4. When to revisit (future SDK versions)
  </action>
  <verify>
```bash
# Verify documentation exists
grep -B 10 "as any.*setRequestHandler\|setRequestHandler as any" src/index.ts | grep -i "SDK LIMITATION"
```
  </verify>
  <done>MCP SDK workaround is documented with clear explanation of the limitation</done>
</task>

<task type="auto">
  <name>Task 2: Final as any audit</name>
  <files>src/</files>
  <action>
Run comprehensive audit of remaining `as any` in production code.

**Step 1: Count all as any in src/ (excluding __tests__)**
```bash
grep -r "as any" src/ --include="*.ts" | grep -v "__tests__" | grep -v "\.test\." | grep -v "CodeExampleGenerator"
```

**Step 2: Categorize remaining instances**
- DOCUMENTED EXCEPTION: index.ts SDK workaround (acceptable)
- EXAMPLE CODE: CodeExampleGenerator.ts (out of scope - documentation examples)
- UNEXPECTED: Any others need investigation

**Step 3: Verify phase success criteria**
- Zero `as any` assertions in production code (verified by grep)
- Exception: 1 documented SDK limitation in index.ts
- Exception: CodeExampleGenerator.ts (documentation examples, not production)

Create a verification report listing:
1. Files checked
2. as any instances found
3. Classification (acceptable/needs-fix)
4. Final status (PASS/FAIL)
  </action>
  <verify>
```bash
cd /Users/vivek/jet/mcp-github-project-manager

echo "=== FINAL AS ANY AUDIT ==="
echo ""
echo "Production files (excluding tests and examples):"
grep -rn "as any" src/ --include="*.ts" | grep -v "__tests__" | grep -v "\.test\." | grep -v "CodeExampleGenerator" | grep -v "index\.ts.*setRequestHandler"

echo ""
echo "=== EXPECTED EXCEPTIONS ==="
echo "1. index.ts SDK workaround:"
grep -n "as any" src/index.ts

echo ""
echo "2. CodeExampleGenerator.ts (documentation examples):"
grep -c "as any" src/services/context/CodeExampleGenerator.ts || echo "0"

echo ""
echo "=== SUMMARY ==="
PROD_COUNT=$(grep -r "as any" src/ --include="*.ts" | grep -v "__tests__" | grep -v "\.test\." | grep -v "CodeExampleGenerator" | grep -v "index\.ts.*setRequestHandler" | wc -l)
echo "Unexpected as any in production: $PROD_COUNT"
if [ "$PROD_COUNT" -eq "0" ]; then
  echo "STATUS: PASS"
else
  echo "STATUS: FAIL - investigate remaining instances"
fi
```
  </verify>
  <done>Audit confirms zero unexpected as any in production code</done>
</task>

<task type="auto">
  <name>Task 3: TypeScript strict mode verification</name>
  <files>src/</files>
  <action>
Run full TypeScript compilation with strict mode to verify:
1. No type errors introduced by phase changes
2. Strict mode still enabled in tsconfig.json
3. All tests pass

**Verification commands:**
```bash
# Verify strict mode enabled
grep '"strict"' tsconfig.json

# Full TypeScript check
npx tsc --noEmit

# Run full test suite
npm test
```

Generate final phase verification report.
  </action>
  <verify>
```bash
cd /Users/vivek/jet/mcp-github-project-manager

echo "=== PHASE 3 COMPLETION VERIFICATION ==="
echo ""

echo "1. TypeScript strict mode:"
grep '"strict"' tsconfig.json

echo ""
echo "2. TypeScript compilation:"
npx tsc --noEmit && echo "PASS" || echo "FAIL"

echo ""
echo "3. Test suite:"
npm test 2>&1 | tail -5

echo ""
echo "4. as any production count (excluding documented exceptions):"
PROD_COUNT=$(grep -r "as any" src/ --include="*.ts" | grep -v "__tests__" | grep -v "\.test\." | grep -v "CodeExampleGenerator" | grep -v "setRequestHandler as any" | wc -l | tr -d ' ')
echo "Count: $PROD_COUNT"

echo ""
echo "=== PHASE 3 SUCCESS CRITERIA ==="
echo "[ ] Zero as any in production (except documented SDK exception)"
echo "[ ] AI response interfaces documented in domain types"
echo "[ ] Type guards exist for external data boundaries"
echo "[ ] TypeScript strict mode produces no errors"
echo "[ ] IDE autocomplete works for AI response objects"
```
  </verify>
  <done>Phase 3 completion verified: strict mode passes, tests pass, as any eliminated</done>
</task>

</tasks>

<verification>
```bash
cd /Users/vivek/jet/mcp-github-project-manager

echo "=== PHASE 3: TYPE SAFETY VERIFICATION ==="
echo ""

# Success Criterion 1: Zero as any in production (except documented)
echo "Criterion 1: as any assertions in production code"
PROD_AS_ANY=$(grep -r "as any" src/ --include="*.ts" | grep -v "__tests__" | grep -v "CodeExampleGenerator" | grep -v "setRequestHandler as any" | wc -l | tr -d ' ')
echo "  Count (excluding exceptions): $PROD_AS_ANY"
[ "$PROD_AS_ANY" -eq "0" ] && echo "  PASS" || echo "  FAIL"

# Success Criterion 2: AI response interfaces documented
echo ""
echo "Criterion 2: AI response interfaces in domain types"
grep -c "export interface\|export type" src/domain/ai-types.ts
grep -c "export interface\|export type" src/domain/type-guards.ts 2>/dev/null || echo "0"
echo "  (verify manually that AI response types exist)"

# Success Criterion 3: Type guards for external data
echo ""
echo "Criterion 3: Type guards for external data boundaries"
grep "export function is\|export function has" src/domain/type-guards.ts 2>/dev/null || echo "  Check type-guards.ts exists"

# Success Criterion 4: TypeScript strict mode
echo ""
echo "Criterion 4: TypeScript strict mode passes"
npx tsc --noEmit && echo "  PASS" || echo "  FAIL"

# Success Criterion 5: IDE autocomplete (manual check)
echo ""
echo "Criterion 5: IDE autocomplete (manual verification)"
echo "  Open ai-types.ts in IDE, verify type definitions show autocomplete"
```
</verification>

<success_criteria>
1. MCP SDK workaround is documented with clear explanation
2. Zero unexpected `as any` in production code (audit confirms)
3. TypeScript compiles without errors in strict mode
4. All tests pass
5. Phase 3 success criteria verified
</success_criteria>

<output>
After completion, create `.planning/phases/03-type-safety/03-05-SUMMARY.md`
</output>
