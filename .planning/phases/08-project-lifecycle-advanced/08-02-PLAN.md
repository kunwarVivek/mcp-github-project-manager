---
phase: 08-project-lifecycle-advanced
plan: 02
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - src/infrastructure/tools/project-lifecycle-tools.ts
  - src/infrastructure/tools/ToolRegistry.ts
  - src/infrastructure/tools/ToolSchemas.ts
autonomous: true

must_haves:
  truths:
    - "User can close a project via close_project tool"
    - "User can reopen a closed project via reopen_project tool"
    - "User can convert draft issue to real issue via convert_draft_issue tool"
  artifacts:
    - path: "src/infrastructure/tools/project-lifecycle-tools.ts"
      provides: "3 MCP tools for project lifecycle operations"
      exports: ["closeProjectTool", "reopenProjectTool", "convertDraftIssueTool"]
    - path: "src/infrastructure/tools/ToolRegistry.ts"
      provides: "Tool registration"
      contains: "closeProjectTool"
  key_links:
    - from: "project-lifecycle-tools.ts"
      to: "project-lifecycle-schemas.ts"
      via: "schema imports"
      pattern: "import.*from.*project-lifecycle-schemas"
    - from: "ToolRegistry.ts"
      to: "project-lifecycle-tools.ts"
      via: "registerTool calls"
      pattern: "this\\.registerTool\\(closeProjectTool\\)"
---

<objective>
Create 3 MCP tools for project lifecycle management: close project (GHAPI-19), reopen project (GHAPI-20), and convert draft issue to real issue (GHAPI-21).

Purpose: Enable users to manage project lifecycle states and convert draft issues to real GitHub issues.
Output: One tools file with 3 tool definitions and executors, plus ToolRegistry updates.
</objective>

<execution_context>
@/Users/vivek/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vivek/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-project-lifecycle-advanced/08-RESEARCH.md

Reference existing tool patterns:
@src/infrastructure/tools/project-template-tools.ts (line 1-100 for structure)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create project-lifecycle-tools.ts with 3 tools</name>
  <files>src/infrastructure/tools/project-lifecycle-tools.ts</files>
  <action>
Create `src/infrastructure/tools/project-lifecycle-tools.ts` with 3 MCP tools following the project-template-tools.ts pattern.

**File Structure:**

1. **Header comment** - Document the 3 tools (GHAPI-19 to GHAPI-21)

2. **Imports:**
   - ToolDefinition, ToolSchema from ToolValidator.js
   - ANNOTATION_PATTERNS from annotations/tool-annotations.js
   - GitHubRepositoryFactory from ../github/GitHubRepositoryFactory.js
   - All input/output schemas and types from ./schemas/project-lifecycle-schemas.js

3. **GraphQL Mutations:**

```typescript
const UPDATE_PROJECT_MUTATION = `
  mutation UpdateProjectV2($input: UpdateProjectV2Input!) {
    updateProjectV2(input: $input) {
      projectV2 {
        id
        title
        closed
        url
      }
    }
  }
`;

const CONVERT_DRAFT_ISSUE_MUTATION = `
  mutation ConvertProjectV2DraftIssueItemToIssue($input: ConvertProjectV2DraftIssueItemToIssueInput!) {
    convertProjectV2DraftIssueItemToIssue(input: $input) {
      item {
        id
        content {
          ... on Issue {
            id
            number
            title
            url
            repository {
              nameWithOwner
            }
          }
        }
      }
    }
  }
`;

const RESOLVE_REPOSITORY_ID_QUERY = `
  query ResolveRepositoryId($owner: String!, $name: String!) {
    repository(owner: $owner, name: $name) {
      id
    }
  }
`;
```

4. **Helper Functions:**

```typescript
function createFactory(): GitHubRepositoryFactory {
  const token = process.env.GITHUB_TOKEN;
  if (!token) {
    throw new Error("GITHUB_TOKEN environment variable is required");
  }
  return new GitHubRepositoryFactory(token, "placeholder", "placeholder");
}

async function resolveRepositoryId(
  factory: GitHubRepositoryFactory,
  owner: string,
  name: string
): Promise<string> {
  // Query repository node ID from owner/name
}
```

5. **GraphQL Response Types:**

```typescript
interface UpdateProjectV2Response {
  updateProjectV2: {
    projectV2: {
      id: string;
      title: string;
      closed: boolean;
      url: string;
    };
  };
}

interface ConvertDraftIssueResponse {
  convertProjectV2DraftIssueItemToIssue: {
    item: {
      id: string;
      content: {
        id: string;
        number: number;
        title: string;
        url: string;
        repository: { nameWithOwner: string };
      };
    };
  };
}
```

6. **Tool Definitions:**

**closeProjectTool (GHAPI-19):**
- name: "close_project"
- title: "Close Project"
- description: "Closes a GitHub ProjectV2. Closed projects are hidden from default views but retain all data and can be reopened."
- schema: CloseProjectInputSchema
- outputSchema: ProjectLifecycleOutputSchema
- annotations: ANNOTATION_PATTERNS.update (destructive=false)
- examples: close a project by ID

**reopenProjectTool (GHAPI-20):**
- name: "reopen_project"
- title: "Reopen Project"
- description: "Reopens a previously closed GitHub ProjectV2. The project becomes visible in default views again."
- schema: ReopenProjectInputSchema
- outputSchema: ProjectLifecycleOutputSchema
- annotations: ANNOTATION_PATTERNS.update
- examples: reopen a closed project

**convertDraftIssueTool (GHAPI-21):**
- name: "convert_draft_issue"
- title: "Convert Draft Issue to Real Issue"
- description: "Converts a draft issue in a project to a real GitHub issue in the specified repository. The draft's title and body are preserved."
- schema: ConvertDraftIssueInputSchema
- outputSchema: ConvertedIssueOutputSchema
- annotations: ANNOTATION_PATTERNS.create
- examples: convert draft to issue in specific repo

7. **Executor Functions:**

**executeCloseProject:**
- Use UPDATE_PROJECT_MUTATION with { projectId, closed: true }
- Return content + structuredContent with ProjectLifecycleOutput

**executeReopenProject:**
- Use UPDATE_PROJECT_MUTATION with { projectId, closed: false }
- Return content + structuredContent with ProjectLifecycleOutput

**executeConvertDraftIssue:**
- Resolve repository ID from owner/name
- Use CONVERT_DRAFT_ISSUE_MUTATION with { itemId, repositoryId }
- Return content + structuredContent with ConvertedIssueOutput

Follow the exact return format from project-template-tools.ts:
```typescript
return {
  content: [{ type: "text", text: JSON.stringify(result, null, 2) }],
  structuredContent: result
};
```
  </action>
  <verify>
```bash
npx tsc --noEmit src/infrastructure/tools/project-lifecycle-tools.ts
```
TypeScript compilation succeeds.
  </verify>
  <done>
3 tool definitions and 3 executor functions are implemented with proper GraphQL mutations.
  </done>
</task>

<task type="auto">
  <name>Task 2: Register tools in ToolRegistry</name>
  <files>src/infrastructure/tools/ToolRegistry.ts</files>
  <action>
Update `src/infrastructure/tools/ToolRegistry.ts` to import and register the 3 new lifecycle tools.

**Add imports** (after project-linking-tools imports):
```typescript
import {
  closeProjectTool,
  reopenProjectTool,
  convertDraftIssueTool,
} from "./project-lifecycle-tools.js";
```

**Add registration** (after Project Linking section, before the closing brace):
```typescript
    // Project Lifecycle (Phase 8)
    this.registerTool(closeProjectTool);
    this.registerTool(reopenProjectTool);
    this.registerTool(convertDraftIssueTool);
```

**Also update ToolSchemas.ts** to re-export tools:

Add at the end of the file:
```typescript
// ============================================================================
// Project Lifecycle Tools
// ============================================================================

// Re-export project lifecycle tools
export {
  closeProjectTool,
  reopenProjectTool,
  convertDraftIssueTool,
  executeCloseProject,
  executeReopenProject,
  executeConvertDraftIssue,
} from "./project-lifecycle-tools.js";
```

This adds 3 more tools to the registry (total will be 106 after all Phase 8 tools).
  </action>
  <verify>
```bash
npx tsc --noEmit src/infrastructure/tools/ToolRegistry.ts
```
TypeScript compilation succeeds.
  </verify>
  <done>
All 3 lifecycle tools are imported and registered in ToolRegistry.
  </done>
</task>

</tasks>

<verification>
After completing all tasks:

1. TypeScript compilation:
```bash
npx tsc --noEmit
```
No errors in the full build.

2. Tools exported:
```bash
grep -c "export const.*Tool" src/infrastructure/tools/project-lifecycle-tools.ts
```
Should return 3.

3. Executors exported:
```bash
grep -c "export async function execute" src/infrastructure/tools/project-lifecycle-tools.ts
```
Should return 3.

4. Tools registered:
```bash
grep -c "closeProjectTool\|reopenProjectTool\|convertDraftIssueTool" src/infrastructure/tools/ToolRegistry.ts
```
Should return 4 (1 import line + 3 registration lines).
</verification>

<success_criteria>
- closeProjectTool closes a project by setting closed=true
- reopenProjectTool reopens a project by setting closed=false
- convertDraftIssueTool converts draft to real issue in specified repository
- All tools have proper annotations, schemas, and examples
- Tools are registered in ToolRegistry
- TypeScript compiles with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/08-project-lifecycle-advanced/08-02-SUMMARY.md`
</output>
