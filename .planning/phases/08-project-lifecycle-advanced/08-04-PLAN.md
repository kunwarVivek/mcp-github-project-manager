---
phase: 08-project-lifecycle-advanced
plan: 04
type: execute
wave: 3
depends_on: ["08-02", "08-03"]
files_modified:
  - tests/infrastructure/tools/project-lifecycle-tools.test.ts
  - tests/infrastructure/tools/project-advanced-tools.test.ts
  - docs/TOOLS.md
  - STATUS.md
autonomous: true

must_haves:
  truths:
    - "All 6 Phase 8 tools have unit tests passing"
    - "Schema validation tests verify input requirements"
    - "Executor tests verify GraphQL calls and response mapping"
    - "Documentation lists all 6 new tools with examples"
  artifacts:
    - path: "tests/infrastructure/tools/project-lifecycle-tools.test.ts"
      provides: "Unit tests for 3 lifecycle tools"
      min_lines: 150
    - path: "tests/infrastructure/tools/project-advanced-tools.test.ts"
      provides: "Unit tests for 3 advanced tools"
      min_lines: 200
    - path: "docs/TOOLS.md"
      provides: "Tool documentation"
      contains: "close_project"
    - path: "STATUS.md"
      provides: "Project status"
      contains: "Phase 8"
  key_links:
    - from: "project-lifecycle-tools.test.ts"
      to: "project-lifecycle-tools.ts"
      via: "imports and mocks"
      pattern: "import.*from.*project-lifecycle-tools"
    - from: "project-advanced-tools.test.ts"
      to: "project-advanced-tools.ts"
      via: "imports and mocks"
      pattern: "import.*from.*project-advanced-tools"
---

<objective>
Create comprehensive unit tests for all 6 Phase 8 MCP tools and update documentation.

Purpose: Verify all tools work correctly and document them for users.
Output: 2 test files (~100 tests total), updated TOOLS.md and STATUS.md.
</objective>

<execution_context>
@/Users/vivek/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vivek/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-project-lifecycle-advanced/08-RESEARCH.md

Reference existing test patterns:
@tests/infrastructure/tools/project-template-tools.test.ts
@tests/infrastructure/tools/project-linking-tools.test.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create tests for project-lifecycle-tools</name>
  <files>tests/infrastructure/tools/project-lifecycle-tools.test.ts</files>
  <action>
Create `tests/infrastructure/tools/project-lifecycle-tools.test.ts` following the project-template-tools.test.ts pattern.

**Test Structure (3 describe blocks):**

```typescript
describe('Project Lifecycle Tools', () => {
  describe('Input Schemas', () => {
    // Schema validation tests
  });

  describe('Tool Definitions', () => {
    // Tool definition structure tests
  });

  describe('Executors', () => {
    // Executor function tests with mocked GraphQL
  });
});
```

**Schema Tests (12+ tests):**

For each input schema (CloseProject, ReopenProject, ConvertDraftIssue):
- Valid input passes validation
- Missing required field fails
- Invalid field type fails
- Extra fields are stripped (if using strict)

**Tool Definition Tests (9 tests):**

For each tool (3 tools x 3 tests):
- Tool has correct name
- Tool has correct annotations
- Tool has outputSchema defined

**Executor Tests (15+ tests):**

Mock pattern:
```typescript
jest.mock('../../../src/infrastructure/github/GitHubRepositoryFactory', () => ({
  GitHubRepositoryFactory: jest.fn().mockImplementation(() => ({
    graphql: jest.fn()
  }))
}));
```

Tests for each executor:

**executeCloseProject:**
- Returns closed project with closed=true
- Handles GITHUB_TOKEN missing error
- Handles project not found error

**executeReopenProject:**
- Returns reopened project with closed=false
- Handles project not found error

**executeConvertDraftIssue:**
- Resolves repository ID successfully
- Converts draft and returns issue details
- Handles repository not found error
- Handles invalid item ID error (not a draft)

Use beforeEach with jest.resetAllMocks() for proper test isolation.
  </action>
  <verify>
```bash
npm test -- tests/infrastructure/tools/project-lifecycle-tools.test.ts --passWithNoTests
```
All tests pass.
  </verify>
  <done>
35+ tests covering schemas, definitions, and executors for 3 lifecycle tools.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create tests for project-advanced-tools</name>
  <files>tests/infrastructure/tools/project-advanced-tools.test.ts</files>
  <action>
Create `tests/infrastructure/tools/project-advanced-tools.test.ts` for the 3 advanced operation tools.

**Test Structure (3 describe blocks):**

```typescript
describe('Project Advanced Tools', () => {
  describe('Input Schemas', () => {
    // Schema validation tests
  });

  describe('Tool Definitions', () => {
    // Tool definition structure tests
  });

  describe('Executors', () => {
    // Executor function tests with mocked GraphQL
  });
});
```

**Schema Tests (15+ tests):**

For UpdateItemPositionInputSchema:
- Valid input with afterId
- Valid input without afterId (move to top)
- Missing projectId fails
- Missing itemId fails

For SearchIssuesAdvancedInputSchema:
- Valid query passes
- Empty query fails
- Pagination defaults work (first=20)
- first > 100 fails

For FilterProjectItemsInputSchema:
- Valid filter with status
- Valid filter with labels array
- Valid filter with multiple criteria
- Empty filter passes (returns all)
- Invalid type enum fails

**Tool Definition Tests (9 tests):**

For each tool:
- Correct name
- Correct annotations (readOnly for search/filter, update for position)
- outputSchema defined

**Executor Tests (25+ tests):**

**executeUpdateItemPosition:**
- Moves item to top (no afterId)
- Moves item after another item
- Handles project not found
- Handles item not found

**executeSearchIssuesAdvanced:**
- Returns issues matching query
- Handles pagination (first, after)
- Maps labels and assignees correctly
- Handles empty results
- Falls back to ISSUE type if ISSUE_ADVANCED fails (optional)

**executeFilterProjectItems:**
- Returns all items when no filter
- Filters by status field value
- Filters by labels (any match)
- Filters by assignee
- Filters by type (Issue, PullRequest, DraftIssue)
- Combines multiple filter criteria
- Handles pagination for large projects
- Returns correct filteredCount vs totalCount

Test the client-side filtering logic thoroughly since it's a critical workaround for API limitation.
  </action>
  <verify>
```bash
npm test -- tests/infrastructure/tools/project-advanced-tools.test.ts --passWithNoTests
```
All tests pass.
  </verify>
  <done>
50+ tests covering schemas, definitions, and executors for 3 advanced tools, with emphasis on client-side filtering.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update TOOLS.md documentation</name>
  <files>docs/TOOLS.md</files>
  <action>
Update `docs/TOOLS.md` to include all 6 new Phase 8 tools.

**Add new section after Project Linking:**

```markdown
### Project Lifecycle

| Tool | Description |
|------|-------------|
| `close_project` | Closes a project (hidden from views, data retained) |
| `reopen_project` | Reopens a closed project |
| `convert_draft_issue` | Converts a draft issue to a real GitHub issue |

### Advanced Operations

| Tool | Description |
|------|-------------|
| `update_item_position` | Reorders items within a project |
| `search_issues_advanced` | Searches issues with AND/OR query syntax |
| `filter_project_items` | Filters project items by status/labels/assignee/type |
```

**Add detailed documentation for each tool:**

For each tool, add:
- Tool name and title
- Description
- Input parameters table
- Output schema description
- Example usage
- Notes (especially for filter_project_items: client-side filtering)

**Update tool count** in introduction:
- Change "103 tools" to "109 tools" (or current count + 6)
- Add "Project Lifecycle (3)" and "Advanced Operations (3)" to category list

Follow the existing format in TOOLS.md exactly.
  </action>
  <verify>
```bash
grep -c "close_project\|reopen_project\|convert_draft_issue\|update_item_position\|search_issues_advanced\|filter_project_items" docs/TOOLS.md
```
Should return 6+ (each tool mentioned at least once).
  </verify>
  <done>
TOOLS.md documents all 6 Phase 8 tools with descriptions, parameters, and examples.
  </done>
</task>

<task type="auto">
  <name>Task 4: Update STATUS.md</name>
  <files>STATUS.md</files>
  <action>
Update `STATUS.md` to reflect Phase 8 completion.

**Updates:**

1. Update tool count in summary section (add 6 to current total)

2. Update phase status:
   - Phase 7: Complete
   - Phase 8: Complete (add this line)

3. Add Phase 8 completion summary:

```markdown
## Phase 8: Project Lifecycle and Advanced Operations

**Status:** Complete
**Completed:** [current date]

### Tools Implemented

| Requirement | Tool | Status |
|-------------|------|--------|
| GHAPI-19 | close_project | PASS |
| GHAPI-20 | reopen_project | PASS |
| GHAPI-21 | convert_draft_issue | PASS |
| GHAPI-22 | update_item_position | PASS |
| GHAPI-23 | search_issues_advanced | PASS |
| GHAPI-24 | filter_project_items | PASS |

### Notes

- Close/reopen uses updateProjectV2 mutation with closed field
- Draft conversion requires repository ID resolution
- Item filtering is client-side (GitHub API limitation)
- Search uses ISSUE_ADVANCED type for AND/OR support
```

4. Update requirements progress:
   - GHAPI: 18/24 -> 24/24 (Phase 6-8 complete)
  </action>
  <verify>
```bash
grep -c "Phase 8" STATUS.md
```
Should return 2+ (header + status line).
  </verify>
  <done>
STATUS.md reflects Phase 8 completion with all 6 requirements marked PASS.
  </done>
</task>

</tasks>

<verification>
After completing all tasks:

1. Run all tests:
```bash
npm test -- tests/infrastructure/tools/project-lifecycle-tools.test.ts tests/infrastructure/tools/project-advanced-tools.test.ts
```
All tests pass.

2. Full test suite:
```bash
npm test
```
No regressions, test count increased.

3. TypeScript compilation:
```bash
npx tsc --noEmit
```
No errors.

4. Documentation complete:
```bash
grep -l "close_project" docs/TOOLS.md STATUS.md
```
Both files updated.
</verification>

<success_criteria>
- 80+ tests covering all 6 Phase 8 tools
- All tests pass with proper mocking
- TOOLS.md documents all tools with examples
- STATUS.md shows Phase 8 complete
- TypeScript compiles with no errors
- No test regressions in existing suite
</success_criteria>

<output>
After completion, create `.planning/phases/08-project-lifecycle-advanced/08-04-SUMMARY.md`
</output>
