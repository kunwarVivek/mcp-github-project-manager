---
phase: 01-service-decomposition
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/services/SubIssueService.ts
  - src/services/MilestoneService.ts
  - src/__tests__/unit/services/SubIssueService.test.ts
  - src/__tests__/unit/services/MilestoneService.test.ts
autonomous: true

must_haves:
  truths:
    - "SubIssueService can be instantiated independently with GitHubRepositoryFactory"
    - "MilestoneService can be instantiated independently with GitHubRepositoryFactory"
    - "SubIssueService methods work identically to ProjectManagementService methods"
    - "MilestoneService methods work identically to ProjectManagementService methods"
  artifacts:
    - path: "src/services/SubIssueService.ts"
      provides: "Issue dependency and sub-issue management"
      exports: ["SubIssueService"]
      min_lines: 80
    - path: "src/services/MilestoneService.ts"
      provides: "Milestone CRUD and metrics operations"
      exports: ["MilestoneService", "MilestoneMetrics"]
      min_lines: 150
    - path: "src/__tests__/unit/services/SubIssueService.test.ts"
      provides: "Unit tests for SubIssueService"
      min_lines: 50
    - path: "src/__tests__/unit/services/MilestoneService.test.ts"
      provides: "Unit tests for MilestoneService"
      min_lines: 80
  key_links:
    - from: "src/services/SubIssueService.ts"
      to: "GitHubRepositoryFactory"
      via: "constructor injection"
      pattern: "constructor.*GitHubRepositoryFactory"
    - from: "src/services/MilestoneService.ts"
      to: "GitHubRepositoryFactory"
      via: "constructor injection"
      pattern: "constructor.*GitHubRepositoryFactory"
---

<objective>
Extract SubIssueService and MilestoneService from ProjectManagementService as independent, testable services.

Purpose: These are leaf services with no dependencies on other extracted services, making them ideal for parallel extraction. SubIssueService handles issue dependencies, status updates, and milestone assignment. MilestoneService handles milestone CRUD and metrics calculations.

Output: Two new service files with their test files. Methods extracted exactly from ProjectManagementService lines 2684-2795 (SubIssue) and lines 464-572, 621-682, 2537-2586 (Milestone).
</objective>

<execution_context>
@/Users/vivek/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vivek/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-service-decomposition/01-RESEARCH.md
@src/services/ProjectManagementService.ts
@src/services/ProjectAutomationService.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract SubIssueService</name>
  <files>
    src/services/SubIssueService.ts
    src/__tests__/unit/services/SubIssueService.test.ts
  </files>
  <action>
Create SubIssueService following the pattern from ProjectAutomationService:

1. Create `src/services/SubIssueService.ts`:
   - Add `@injectable()` decorator from tsyringe
   - Constructor takes `@inject("GitHubRepositoryFactory") private factory: GitHubRepositoryFactory`
   - Add private getters for `issueRepo` and `milestoneRepo` (same pattern as ProjectManagementService)
   - Copy `mapErrorToMCPError` method from ProjectManagementService
   - Extract these methods from ProjectManagementService (lines 2684-2795):
     - `updateIssueStatus` (lines 2685-2696)
     - `addIssueDependency` (lines 2698-2721)
     - `getIssueDependencies` (lines 2723-2742)
     - `assignIssueToMilestone` (lines 2744-2760)
     - `getIssueHistory` (lines 2762-2795)
   - Export the `IssueDependency` interface (currently internal to ProjectManagementService)

2. Create `src/__tests__/unit/services/SubIssueService.test.ts`:
   - Follow test pattern from ProjectManagementService.test.ts
   - Mock GitHubRepositoryFactory
   - Test each extracted method
   - Verify error handling wraps errors correctly

Do NOT modify ProjectManagementService yet - that happens in Plan 04.
  </action>
  <verify>
    - `npx tsc --noEmit` shows no type errors in SubIssueService.ts
    - `npm test -- --testPathPattern="SubIssueService" --passWithNoTests` runs without errors
  </verify>
  <done>
    - SubIssueService.ts exists with all 5 methods extracted
    - SubIssueService.test.ts has tests for core methods
    - Service can be instantiated with factory injection
  </done>
</task>

<task type="auto">
  <name>Task 2: Extract MilestoneService</name>
  <files>
    src/services/MilestoneService.ts
    src/__tests__/unit/services/MilestoneService.test.ts
  </files>
  <action>
Create MilestoneService following the same pattern:

1. Create `src/services/MilestoneService.ts`:
   - Add `@injectable()` decorator from tsyringe
   - Constructor takes `@inject("GitHubRepositoryFactory") private factory: GitHubRepositoryFactory`
   - Add private getters for `milestoneRepo` and `issueRepo`
   - Copy `mapErrorToMCPError` method
   - Move the `MilestoneMetrics` interface from ProjectManagementService to this file
   - Extract these methods from ProjectManagementService:
     - `getMilestoneMetrics` (lines 464-508)
     - `getOverdueMilestones` (lines 510-538)
     - `getUpcomingMilestones` (lines 540-572)
     - `createMilestone` (lines 621-637)
     - `listMilestones` (lines 639-682)
     - `updateMilestone` (lines 2538-2571)
     - `deleteMilestone` (lines 2573-2586)

2. Create `src/__tests__/unit/services/MilestoneService.test.ts`:
   - Mock GitHubRepositoryFactory and its repository return values
   - Test getMilestoneMetrics with various issue states
   - Test overdue/upcoming milestone filtering
   - Test CRUD operations
   - Verify completion percentage calculations

Do NOT modify ProjectManagementService yet.
  </action>
  <verify>
    - `npx tsc --noEmit` shows no type errors in MilestoneService.ts
    - `npm test -- --testPathPattern="MilestoneService" --passWithNoTests` runs without errors
  </verify>
  <done>
    - MilestoneService.ts exists with all 7 methods extracted
    - MilestoneMetrics interface exported from MilestoneService
    - MilestoneService.test.ts has tests covering metrics and CRUD
    - Service can be instantiated with factory injection
  </done>
</task>

</tasks>

<verification>
After completing both tasks:
1. `npx tsc --noEmit` - No TypeScript errors in new files
2. `npm test -- --testPathPattern="SubIssueService|MilestoneService"` - New tests pass
3. Both services can be imported and instantiated in a test script:
```typescript
import { SubIssueService } from './src/services/SubIssueService';
import { MilestoneService } from './src/services/MilestoneService';
```
</verification>

<success_criteria>
1. SubIssueService.ts exists with 5 methods, @injectable() decorator, factory injection
2. MilestoneService.ts exists with 7 methods, @injectable() decorator, factory injection
3. Both test files exist with meaningful test coverage
4. TypeScript compiles without errors
5. Tests pass for new services
6. Services do NOT yet replace methods in ProjectManagementService (that's Plan 04)
</success_criteria>

<output>
After completion, create `.planning/phases/01-service-decomposition/01-01-SUMMARY.md`
</output>
