---
phase: 01-service-decomposition
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/services/ProjectTemplateService.ts
  - src/services/ProjectLinkingService.ts
  - src/__tests__/unit/services/ProjectTemplateService.test.ts
  - src/__tests__/unit/services/ProjectLinkingService.test.ts
autonomous: true

must_haves:
  truths:
    - "ProjectTemplateService can be instantiated independently with GitHubRepositoryFactory"
    - "ProjectLinkingService can be instantiated independently with GitHubRepositoryFactory"
    - "ProjectTemplateService methods work identically to ProjectManagementService methods"
    - "ProjectLinkingService methods work identically to ProjectManagementService methods"
  artifacts:
    - path: "src/services/ProjectTemplateService.ts"
      provides: "Project views, fields, and README operations"
      exports: ["ProjectTemplateService"]
      min_lines: 150
    - path: "src/services/ProjectLinkingService.ts"
      provides: "Project item add/remove/archive operations"
      exports: ["ProjectLinkingService"]
      min_lines: 150
    - path: "src/__tests__/unit/services/ProjectTemplateService.test.ts"
      provides: "Unit tests for ProjectTemplateService"
      min_lines: 60
    - path: "src/__tests__/unit/services/ProjectLinkingService.test.ts"
      provides: "Unit tests for ProjectLinkingService"
      min_lines: 60
  key_links:
    - from: "src/services/ProjectTemplateService.ts"
      to: "GitHubRepositoryFactory"
      via: "constructor injection"
      pattern: "constructor.*GitHubRepositoryFactory"
    - from: "src/services/ProjectLinkingService.ts"
      to: "GitHubRepositoryFactory"
      via: "constructor injection"
      pattern: "constructor.*GitHubRepositoryFactory"
    - from: "src/services/ProjectTemplateService.ts"
      to: "factory.graphql"
      via: "direct GraphQL calls"
      pattern: "factory\\.graphql"
    - from: "src/services/ProjectLinkingService.ts"
      to: "factory.graphql"
      via: "direct GraphQL calls"
      pattern: "factory\\.graphql"
---

<objective>
Extract ProjectTemplateService and ProjectLinkingService from ProjectManagementService as independent, testable services.

Purpose: Both services are GraphQL-heavy and handle project customization. ProjectTemplateService manages views, fields, and README. ProjectLinkingService manages project items (add, remove, archive, list). They have no cross-dependencies.

Output: Two new service files with their test files. Methods extracted from ProjectManagementService lines 1076-1192, 2388-2535 (Template) and lines 1194-1375, 1732-1872 (Linking).
</objective>

<execution_context>
@/Users/vivek/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vivek/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-service-decomposition/01-RESEARCH.md
@src/services/ProjectManagementService.ts
@src/services/ProjectAutomationService.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract ProjectTemplateService</name>
  <files>
    src/services/ProjectTemplateService.ts
    src/__tests__/unit/services/ProjectTemplateService.test.ts
  </files>
  <action>
Create ProjectTemplateService following the established pattern:

1. Create `src/services/ProjectTemplateService.ts`:
   - Add `@injectable()` decorator from tsyringe
   - Constructor takes `@inject("GitHubRepositoryFactory") private factory: GitHubRepositoryFactory`
   - Add private getter for `projectRepo`
   - Copy `mapErrorToMCPError` method
   - Extract these methods from ProjectManagementService:
     - `getProjectReadme` (lines 1077-1107) - get project README via GraphQL
     - `updateProjectReadme` (lines 1109-1148) - update README via GraphQL
     - `listProjectFields` (lines 1150-1162) - list custom fields
     - `updateProjectField` (lines 1164-1192) - update field config
     - `createProjectView` (lines 2389-2403) - create view
     - `listProjectViews` (lines 2405-2457) - list views via GraphQL
     - `updateProjectView` (lines 2459-2519) - update view via GraphQL
     - `deleteProjectView` (lines 2521-2535) - delete view

   IMPORTANT: Several methods use `this.factory.graphql()` directly for GraphQL mutations.
   Keep this pattern - it's appropriate for complex mutations not exposed via repositories.

2. Create `src/__tests__/unit/services/ProjectTemplateService.test.ts`:
   - Mock GitHubRepositoryFactory with graphql method
   - Test README get/update with GraphQL mock responses
   - Test view CRUD operations
   - Test field operations
   - Verify error handling for GraphQL errors

Do NOT modify ProjectManagementService yet.
  </action>
  <verify>
    - `npx tsc --noEmit` shows no type errors in ProjectTemplateService.ts
    - `npm test -- --testPathPattern="ProjectTemplateService" --passWithNoTests` runs without errors
  </verify>
  <done>
    - ProjectTemplateService.ts exists with 8 methods extracted
    - GraphQL mutations preserved as-is from original
    - ProjectTemplateService.test.ts covers view/field/README operations
  </done>
</task>

<task type="auto">
  <name>Task 2: Extract ProjectLinkingService</name>
  <files>
    src/services/ProjectLinkingService.ts
    src/__tests__/unit/services/ProjectLinkingService.test.ts
  </files>
  <action>
Create ProjectLinkingService following the same pattern:

1. Create `src/services/ProjectLinkingService.ts`:
   - Add `@injectable()` decorator from tsyringe
   - Constructor takes `@inject("GitHubRepositoryFactory") private factory: GitHubRepositoryFactory`
   - Copy `mapErrorToMCPError` method
   - Extract these methods from ProjectManagementService:
     - `addProjectItem` (lines 1195-1258) - add issue/PR to project via GraphQL
     - `removeProjectItem` (lines 1260-1293) - remove item via GraphQL
     - `archiveProjectItem` (lines 1295-1334) - archive item via GraphQL
     - `unarchiveProjectItem` (lines 1336-1375) - unarchive item via GraphQL
     - `listProjectItems` (lines 1732-1872) - list items with filtering

   All methods use GraphQL mutations for project item operations.
   This is the standard pattern for GitHub Projects v2 item management.

2. Create `src/__tests__/unit/services/ProjectLinkingService.test.ts`:
   - Mock GitHubRepositoryFactory with graphql method
   - Test addProjectItem for issues and PRs
   - Test remove/archive/unarchive operations
   - Test listProjectItems with various filters
   - Verify error handling for item not found scenarios

Do NOT modify ProjectManagementService yet.
  </action>
  <verify>
    - `npx tsc --noEmit` shows no type errors in ProjectLinkingService.ts
    - `npm test -- --testPathPattern="ProjectLinkingService" --passWithNoTests` runs without errors
  </verify>
  <done>
    - ProjectLinkingService.ts exists with 5 methods extracted
    - All GraphQL mutations preserved from original
    - ProjectLinkingService.test.ts covers item operations
  </done>
</task>

</tasks>

<verification>
After completing both tasks:
1. `npx tsc --noEmit` - No TypeScript errors in new files
2. `npm test -- --testPathPattern="ProjectTemplateService|ProjectLinkingService"` - New tests pass
3. Both services can be imported and instantiated
4. GraphQL patterns match original ProjectManagementService usage
</verification>

<success_criteria>
1. ProjectTemplateService.ts exists with 8 methods, @injectable(), factory injection
2. ProjectLinkingService.ts exists with 5 methods, @injectable(), factory injection
3. GraphQL mutations preserved exactly from original service
4. Both test files exist with meaningful test coverage
5. TypeScript compiles without errors
6. Tests pass for new services
7. Direct factory.graphql() usage maintained where original used it
</success_criteria>

<output>
After completion, create `.planning/phases/01-service-decomposition/01-03-SUMMARY.md`
</output>
