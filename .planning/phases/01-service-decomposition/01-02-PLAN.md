---
phase: 01-service-decomposition
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/services/SprintPlanningService.ts
  - src/services/ProjectStatusService.ts
  - src/__tests__/unit/services/SprintPlanningService.test.ts
  - src/__tests__/unit/services/ProjectStatusService.test.ts
autonomous: true

must_haves:
  truths:
    - "SprintPlanningService can be instantiated independently with GitHubRepositoryFactory"
    - "ProjectStatusService can be instantiated independently with GitHubRepositoryFactory"
    - "SprintPlanningService methods work identically to ProjectManagementService methods"
    - "ProjectStatusService methods work identically to ProjectManagementService methods"
  artifacts:
    - path: "src/services/SprintPlanningService.ts"
      provides: "Sprint CRUD, planning, and metrics operations"
      exports: ["SprintPlanningService", "SprintMetrics"]
      min_lines: 180
    - path: "src/services/ProjectStatusService.ts"
      provides: "Project CRUD operations"
      exports: ["ProjectStatusService"]
      min_lines: 80
    - path: "src/__tests__/unit/services/SprintPlanningService.test.ts"
      provides: "Unit tests for SprintPlanningService"
      min_lines: 80
    - path: "src/__tests__/unit/services/ProjectStatusService.test.ts"
      provides: "Unit tests for ProjectStatusService"
      min_lines: 50
  key_links:
    - from: "src/services/SprintPlanningService.ts"
      to: "GitHubRepositoryFactory"
      via: "constructor injection"
      pattern: "constructor.*GitHubRepositoryFactory"
    - from: "src/services/ProjectStatusService.ts"
      to: "GitHubRepositoryFactory"
      via: "constructor injection"
      pattern: "constructor.*GitHubRepositoryFactory"
---

<objective>
Extract SprintPlanningService and ProjectStatusService from ProjectManagementService as independent, testable services.

Purpose: Both services access issueRepo/projectRepo but have no cross-dependencies, making them parallel-extractable. SprintPlanningService handles sprint lifecycle and metrics. ProjectStatusService handles project CRUD operations.

Output: Two new service files with their test files. Methods extracted from ProjectManagementService lines 262-462, 944-1024 (Sprint) and lines 574-618, 1026-1074 (ProjectStatus).
</objective>

<execution_context>
@/Users/vivek/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vivek/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-service-decomposition/01-RESEARCH.md
@src/services/ProjectManagementService.ts
@src/services/ProjectAutomationService.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract SprintPlanningService</name>
  <files>
    src/services/SprintPlanningService.ts
    src/__tests__/unit/services/SprintPlanningService.test.ts
  </files>
  <action>
Create SprintPlanningService following the established pattern:

1. Create `src/services/SprintPlanningService.ts`:
   - Add `@injectable()` decorator from tsyringe
   - Constructor takes `@inject("GitHubRepositoryFactory") private factory: GitHubRepositoryFactory`
   - Add private getters for `sprintRepo` and `issueRepo`
   - Copy `mapErrorToMCPError` method
   - Move the `SprintMetrics` interface from ProjectManagementService
   - Copy `PlanSprintSchema` Zod schema from ProjectManagementService
   - Extract these methods from ProjectManagementService:
     - `planSprint` (lines 262-305) - creates sprint with issues
     - `findSprints` (lines 307-313) - find by filter
     - `updateSprint` (lines 315-362) - update sprint
     - `addIssuesToSprint` (lines 364-391) - add issues
     - `removeIssuesFromSprint` (lines 393-420) - remove issues
     - `getSprintMetrics` (lines 422-462) - calculate metrics
     - `createSprint` (lines 945-967) - NOTE: consolidate with planSprint if duplicate
     - `listSprints` (lines 969-997) - list sprints
     - `getCurrentSprint` (lines 999-1024) - get active sprint

   IMPORTANT: Research noted `createSprint` and `planSprint` may have overlapping functionality.
   Consolidate if they're duplicates, keeping the richer implementation.

2. Create `src/__tests__/unit/services/SprintPlanningService.test.ts`:
   - Mock GitHubRepositoryFactory, sprintRepo, issueRepo
   - Test planSprint creates sprint and associates issues
   - Test getSprintMetrics calculates completion correctly
   - Test getCurrentSprint returns active sprint
   - Test addIssuesToSprint/removeIssuesFromSprint operations

Do NOT modify ProjectManagementService yet.
  </action>
  <verify>
    - `npx tsc --noEmit` shows no type errors in SprintPlanningService.ts
    - `npm test -- --testPathPattern="SprintPlanningService" --passWithNoTests` runs without errors
  </verify>
  <done>
    - SprintPlanningService.ts exists with sprint management methods
    - SprintMetrics interface exported
    - Duplicate methods (if any) consolidated
    - SprintPlanningService.test.ts has tests for core operations
  </done>
</task>

<task type="auto">
  <name>Task 2: Extract ProjectStatusService</name>
  <files>
    src/services/ProjectStatusService.ts
    src/__tests__/unit/services/ProjectStatusService.test.ts
  </files>
  <action>
Create ProjectStatusService following the same pattern:

1. Create `src/services/ProjectStatusService.ts`:
   - Add `@injectable()` decorator from tsyringe
   - Constructor takes `@inject("GitHubRepositoryFactory") private factory: GitHubRepositoryFactory`
   - Add private getter for `projectRepo`
   - Copy `mapErrorToMCPError` method
   - Extract these methods from ProjectManagementService:
     - `createProject` (lines 575-592) - create project
     - `listProjects` (lines 594-610) - list projects
     - `getProject` (lines 612-618) - get single project
     - `updateProject` (lines 1027-1060) - update project
     - `deleteProject` (lines 1062-1074) - delete project

   NOTE: This service handles basic project CRUD. More complex project operations
   (templates, linking) go in other services.

2. Create `src/__tests__/unit/services/ProjectStatusService.test.ts`:
   - Mock GitHubRepositoryFactory and projectRepo
   - Test CRUD operations (create, list, get, update, delete)
   - Test error handling for not-found scenarios
   - Test validation errors

Do NOT modify ProjectManagementService yet.
  </action>
  <verify>
    - `npx tsc --noEmit` shows no type errors in ProjectStatusService.ts
    - `npm test -- --testPathPattern="ProjectStatusService" --passWithNoTests` runs without errors
  </verify>
  <done>
    - ProjectStatusService.ts exists with 5 CRUD methods
    - ProjectStatusService.test.ts has tests for all CRUD operations
    - Service can be instantiated with factory injection
  </done>
</task>

</tasks>

<verification>
After completing both tasks:
1. `npx tsc --noEmit` - No TypeScript errors in new files
2. `npm test -- --testPathPattern="SprintPlanningService|ProjectStatusService"` - New tests pass
3. Both services can be imported and instantiated
</verification>

<success_criteria>
1. SprintPlanningService.ts exists with sprint methods, @injectable(), factory injection
2. ProjectStatusService.ts exists with 5 CRUD methods, @injectable(), factory injection
3. SprintMetrics interface exported from SprintPlanningService
4. Both test files exist with meaningful test coverage
5. TypeScript compiles without errors
6. Tests pass for new services
7. Duplicate methods in SprintPlanningService consolidated with documentation
</success_criteria>

<output>
After completion, create `.planning/phases/01-service-decomposition/01-02-SUMMARY.md`
</output>
