---
phase: 11-ai-issue-intelligence
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/domain/issue-intelligence-types.ts
  - src/infrastructure/tools/schemas/issue-intelligence-schemas.ts
autonomous: true

must_haves:
  truths:
    - "Issue enrichment types support structured sections (Problem/Solution/Context/Impact/AcceptanceCriteria)"
    - "Label suggestion types support tiered confidence (high/medium/low) with rationale"
    - "Duplicate detection types support similarity thresholds and tiered responses"
    - "Related issue linking types support semantic/dependency/component relationship types"
  artifacts:
    - path: "src/domain/issue-intelligence-types.ts"
      provides: "TypeScript interfaces for issue intelligence AI services"
      exports: ["EnrichedIssue", "LabelSuggestion", "DuplicateCandidate", "IssueRelationship"]
    - path: "src/infrastructure/tools/schemas/issue-intelligence-schemas.ts"
      provides: "Zod schemas for MCP tool input/output validation"
      exports: ["EnrichIssueInputSchema", "SuggestLabelsInputSchema", "DetectDuplicatesInputSchema", "FindRelatedIssuesInputSchema"]
  key_links:
    - from: "src/infrastructure/tools/schemas/issue-intelligence-schemas.ts"
      to: "src/domain/ai-types.ts"
      via: "SectionConfidence import"
      pattern: "import.*SectionConfidence.*from.*ai-types"
---

<objective>
Create domain types and Zod schemas for Phase 11 AI Issue Intelligence features.

Purpose: Establish the type foundation that AI services and MCP tools will use. Following the Phase 10 pattern where domain types are separate from Zod schemas.

Output:
- `src/domain/issue-intelligence-types.ts` - ~25 TypeScript interfaces for enrichment, labels, duplicates, related issues
- `src/infrastructure/tools/schemas/issue-intelligence-schemas.ts` - ~30 Zod schemas for 4 MCP tools input/output
</objective>

<execution_context>
@/Users/vivek/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vivek/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-ai-issue-intelligence/11-CONTEXT.md
@.planning/phases/11-ai-issue-intelligence/11-RESEARCH.md
@src/domain/ai-types.ts (SectionConfidence, ConfidenceFactors patterns)
@src/domain/sprint-planning-types.ts (domain type file pattern)
@src/infrastructure/tools/schemas/sprint-roadmap-schemas.ts (Zod schema file pattern)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create issue-intelligence-types.ts domain types</name>
  <files>src/domain/issue-intelligence-types.ts</files>
  <action>
Create TypeScript interfaces for all four AI-17 to AI-20 requirements. Follow the sprint-planning-types.ts pattern.

**File header:**
```typescript
/**
 * Issue Intelligence Domain Types
 *
 * TypeScript interfaces for AI-powered issue management:
 * - AI-17: Issue enrichment with structured sections
 * - AI-18: Multi-tier label suggestions with rationale
 * - AI-19: Duplicate detection with similarity scoring
 * - AI-20: Related issue linking by relationship type
 */

import { SectionConfidence } from "./ai-types";
```

**Issue Enrichment Types (AI-17):**
- `EnrichedSection`: content + confidence per section
- `EnrichedIssueSections`: problem, solution, context, impact, acceptanceCriteria (all optional EnrichedSection)
- `EnrichedIssue`: original (title, body), preserveOriginal boolean, enrichedBody string, sections, suggestedLabels, suggestedAssignees, overallConfidence

**Label Suggestion Types (AI-18):**
- `LabelSuggestion`: label name, isExisting, confidence (0-1), rationale, matchedPatterns array
- `NewLabelProposal`: name, description, color (hex without #), rationale
- `LabelSuggestionResult`: high/medium/low arrays of LabelSuggestion, newLabelProposals, confidence (SectionConfidence)
- `LabelSuggestionConfig`: preferExisting boolean, maxSuggestions number, includeNewProposals boolean, confidenceThresholds (high/medium numbers)

**Duplicate Detection Types (AI-19):**
- `DuplicateCandidate`: issueId, issueNumber, title, similarity score (0-1), reasoning
- `DuplicateDetectionThresholds`: high (0.92 default), medium (0.75 default)
- `DuplicateDetectionResult`: highConfidence array, mediumConfidence array, lowConfidence array, newEmbedding number[] optional, confidence (SectionConfidence)
- `DuplicateAction`: 'auto_link' | 'flag_for_review' | 'ignore'

**Related Issue Linking Types (AI-20):**
- `RelationshipType`: 'semantic' | 'dependency' | 'component'
- `DependencySubType`: 'blocks' | 'blocked_by' | 'related_to'
- `IssueRelationship`: sourceIssueId, targetIssueId, targetIssueNumber, targetIssueTitle, relationshipType, subType (optional DependencySubType), confidence, reasoning
- `RelatedIssueResult`: relationships array, confidence (SectionConfidence)
- `RelatedIssueLinkingConfig`: includeSemanticSimilarity, includeDependencies, includeComponentGrouping (all booleans)

**Common Types:**
- `IssueInput`: id, number, title, body, labels array, state ('open' | 'closed'), createdAt, updatedAt optional
- `RepositoryContext`: owner, repo, labels array of {name, description?, color?}
- `IssueIntelligenceConfig`: enrichment, labelSuggestion, duplicateDetection, relatedLinking (nested configs)

Export all types.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit src/domain/issue-intelligence-types.ts`</verify>
  <done>~25 TypeScript interfaces covering AI-17 to AI-20 requirements with SectionConfidence integration</done>
</task>

<task type="auto">
  <name>Task 2: Create issue-intelligence-schemas.ts Zod schemas</name>
  <files>src/infrastructure/tools/schemas/issue-intelligence-schemas.ts</files>
  <action>
Create Zod schemas for 4 MCP tools. Follow the sprint-roadmap-schemas.ts pattern.

**File header:**
```typescript
/**
 * Zod Schemas for Issue Intelligence AI MCP Tools
 *
 * This module defines input and output schemas for Phase 11 AI Issue
 * Intelligence MCP tools:
 *
 * Issue Intelligence Tools (AI-17 to AI-20):
 * - enrich_issue (AI-17)
 * - suggest_labels (AI-18)
 * - detect_duplicates (AI-19)
 * - find_related_issues (AI-20)
 */

import { z } from "zod";
import { SectionConfidenceSchema } from "../../../domain/ai-types";
```

**Common Schemas:**
- `IssueInputSchema`: id, number (int), title, body, labels (string array), state (enum open/closed), createdAt, updatedAt optional
- `RepositoryLabelSchema`: name, description optional, color optional
- `RepositoryContextSchema`: owner, repo, labels array of RepositoryLabelSchema
- `ConfidenceTierOutputSchema`: tier enum (high/medium/low), score (0-1)

**Enrich Issue Schemas (AI-17):**
- Input: issueTitle, issueDescription (can be empty), projectContext optional, repositoryLabels optional array
- Output: original (title, body), preserveOriginal boolean, enrichedBody, sections object (problem, solution, context, impact, acceptanceCriteria - each with content and confidence), suggestedLabels array, suggestedAssignees optional array, overallConfidence

**Suggest Labels Schemas (AI-18):**
- Input: issueTitle, issueDescription, existingLabels array, issueHistory optional array of {labels, title}, config optional {preferExisting, maxSuggestions, includeNewProposals}
- Output: high array, medium array, low array (each of {label, isExisting, confidence, rationale, matchedPatterns}), newLabelProposals optional array, confidence

**Detect Duplicates Schemas (AI-19):**
- Input: issueTitle, issueDescription, existingIssues array of {id, number, title, body, state}, thresholds optional {high, medium}, maxResults optional (default 10)
- Output: highConfidence array, mediumConfidence array, lowConfidence array (each of {issueId, issueNumber, title, similarity, reasoning}), confidence

**Find Related Issues Schemas (AI-20):**
- Input: issueId, issueTitle, issueDescription, issueLabels optional array, repositoryIssues array of {id, number, title, body, labels, state}, config optional {includeSemanticSimilarity, includeDependencies, includeComponentGrouping}
- Output: relationships array of {sourceIssueId, targetIssueId, targetIssueNumber, targetIssueTitle, relationshipType, subType optional, confidence, reasoning}, confidence

Export all schemas AND inferred TypeScript types.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit src/infrastructure/tools/schemas/issue-intelligence-schemas.ts`</verify>
  <done>~30 Zod schemas with input/output types for 4 MCP tools</done>
</task>

<task type="auto">
  <name>Task 3: Verify type consistency and exports</name>
  <files>src/domain/issue-intelligence-types.ts, src/infrastructure/tools/schemas/issue-intelligence-schemas.ts</files>
  <action>
Verify both files compile and exports are consistent:

1. Run full TypeScript check:
   ```bash
   npx tsc --noEmit
   ```

2. Verify domain types file exports all required interfaces by checking grep output

3. Verify Zod schemas file exports all required schemas and inferred types

4. Ensure SectionConfidenceSchema import from ai-types works correctly

5. Add any missing JSDoc comments for exported types

Fix any compilation errors found.
  </action>
  <verify>`npx tsc --noEmit` passes with 0 errors</verify>
  <done>Both files compile, all types exported, SectionConfidence integrated correctly</done>
</task>

</tasks>

<verification>
Run after all tasks complete:
```bash
# TypeScript compilation
npx tsc --noEmit

# Verify domain types exist
grep -c "export interface" src/domain/issue-intelligence-types.ts

# Verify Zod schemas exist
grep -c "export const.*Schema" src/infrastructure/tools/schemas/issue-intelligence-schemas.ts

# Verify SectionConfidence integration
grep "SectionConfidence" src/domain/issue-intelligence-types.ts
grep "SectionConfidenceSchema" src/infrastructure/tools/schemas/issue-intelligence-schemas.ts
```
</verification>

<success_criteria>
- [ ] TypeScript compilation passes with 0 errors
- [ ] Domain types file has ~25 exported interfaces
- [ ] Zod schemas file has ~30 exported schemas
- [ ] SectionConfidence imported and used in both files
- [ ] All four requirements (AI-17 to AI-20) have supporting types
</success_criteria>

<output>
After completion, create `.planning/phases/11-ai-issue-intelligence/11-01-SUMMARY.md`
</output>
